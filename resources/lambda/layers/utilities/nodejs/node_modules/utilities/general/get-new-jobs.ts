const AWS = require("aws-sdk");

const ssm = new AWS.SSM();


  const params = {
    Name: "LATEST_READ",
    Type: "String",
    Description: "latest read of RSS feed",
    Overwrite: true,
  };


const getNewJobs = async(feed: any) => {

  const latestRead = await getLatestRead()

  setLatestRead(feed.items[0].isoDate)

  const newJobs = feed.items.filter(item => {
    const itemDate = new Date(item.isoDate)
    const lastReadDate = new Date (latestRead.Parameter.Value)
   return itemDate > lastReadDate
  })

  return newJobs
}

export default getNewJobs


 const setLatestRead = async (date: string) => {

  try {
    return await ssm.putParameter({
      ...params,
      Value: date
    }).promise();
  } catch (error) {
    console.log(error, 'error')
  }
    
  
}

const getLatestRead = async () => {
    try {
      return await ssm.getParameter({
        Name: params.Name
      }).promise();
  } catch (err) {
    return '2000-01-01'
  }
}