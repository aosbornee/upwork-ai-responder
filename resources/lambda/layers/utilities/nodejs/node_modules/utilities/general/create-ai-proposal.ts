import authoriseOpenaiAccount from "./authorise-openai-account"


if (!process.env.WEBSITE_URL) throw new Error("Missing WEBSITE_URL!!")

const websiteUrl = process.env.WEBSITE_URL

let loomUrl = "https://www.loom.com/share/be8ed27e975f466d9adc90086516830f"

function removeTags(str: string) {
    return str.replace( /(<([^>]+)>)/ig, '');
}

const createAiProposal = async (content: string) => {

  content = removeTags(content)
  
  const openAi = authoriseOpenaiAccount()

  try {
      const completion = await openAi.createCompletion({
  model: "text-davinci-003",
  prompt: `Please respond to the proposal explaining why I am the best candidate
            Make sure to use fluent english vocabulary and end the proposal by saying "peace, Andrew"
            Also ensure to tell them to head to my website: ${websiteUrl} and to check my loom video ${loomUrl}
            
            ${content}`,
    max_tokens: 3000
  });
return completion.data.choices[0].text

  } catch (error) {
    console.log(error, 'error')
  }




}



export default createAiProposal