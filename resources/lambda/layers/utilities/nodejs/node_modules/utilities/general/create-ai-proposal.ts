import authoriseOpenaiAccount from "./authorise-openai-account"


let websiteUrl = "https://levvio.io"
let loomUrl = "https://www.loom.com/share/be8ed27e975f466d9adc90086516830"

function removeTags(str: string) {
    if ((str===null) || (str===''))
        return false;
    // else
    //     str = str.toString();
          
    // Regular expression to identify HTML tags in
    // the input string. Replacing the identified
    // HTML tag with a null string.
    return str.replace( /(<([^>]+)>)/ig, '');
}

const createAiProposal = async (content: string) => {

  const parsedProposal = removeTags(content)
  
  const openAi = authoriseOpenaiAccount()

  try {
      const completion = await openAi.createCompletion({
  model: "text-davinci-003",
  prompt: `Respond to the proposal below explaining why I am the best person for the job, you must link my website ${websiteUrl} and also ask them to watch this loom video ${loomUrl} to learn more about my skills:
            ${parsedProposal}
          `,
    temperature: 0.6,
    max_tokens: 3000
  });
// console.log(completion.data.choices[0].text);
return completion.data.choices[0].text

  } catch (error) {
    console.log(error, 'error')
  }




}



export default createAiProposal